<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <link rel="shortcut icon" href="https://lixingyu.cn/star.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HiFiNi Music List</title>
  <link rel="stylesheet" href="https://unpkg.com/aplayer/dist/APlayer.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      background-color: #f5f5f5;
      color: #333;
    }

    .container {
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border-radius: 8px;
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 10px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .btn {
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background-color: #2980b9;
    }

    .btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }

    .music-list {
      display: flex;
      flex-wrap: wrap;
      padding: 20px;
      align-content: flex-start;
      gap: 10px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .music-item {
      width: calc(10% - 9px);
      /* è€ƒè™‘åˆ°é—´è· */
      padding: 12px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      border-radius: 8px;
      border: 1px solid #f2f2f2;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      background: #fff;
    }

    .music-item:hover {
      background: #f0f6ff;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.08);
    }

    .music-title {
      font-weight: 700;
      color: #222;
      font-size: 15px;
      margin-bottom: 4px;
      letter-spacing: 0.5px;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .music-author {
      color: #999;
      font-size: 12px;
      font-weight: 400;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .loading {
      text-align: center;
      padding: 20px;
      display: none;
    }

    .loading::after {
      content: "Loading...";
      animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {

      0%,
      20% {
        content: "Loading.   ";
      }

      40% {
        content: "Loading..  ";
      }

      60% {
        content: "Loading... ";
      }

      80% {
        content: "Loading....";
      }

      100% {
        content: "Loading.....";
      }
    }

    .error {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
      display: none;
    }

    .status {
      text-align: center;
      color: #666;
      margin: 10px 0;
    }

    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .page-btn {
      padding: 5px 10px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }

    .page-btn.active {
      background-color: #3498db;
      color: white;
      border-color: #3498db;
    }

    /* ç®€æ´æ‚¬æµ®æ’­æ”¾å™¨æ ·å¼ */
    .player-float-wrap {
      position: fixed;
      left: auto;
      top: 30px;
      right: 30px;
      bottom: auto;
      width: 640px;
      min-width: 320px;
      max-width: 90vw;
      z-index: 2000;
      transition: box-shadow 0.2s;
    }

    .music-player {
      position: relative;
      width: 100%;
      background: #fff;
      border-radius: 16px 16px 8px 8px;
      box-shadow: 0 8px 32px rgba(52, 152, 219, 0.13);
      display: grid;
      grid-template-columns: 1fr auto auto;
      grid-gap: 10px;
      align-items: center;
      padding: 20px 28px 20px 20px;
      transition: box-shadow 0.2s;
      user-select: none;
    }

    .player-header-draggable {
      display: flex;
      align-items: center;
      width: 100%;
      cursor: move;
      user-select: none;
      grid-column: 1;
    }

    .music-player .player-cover {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      object-fit: cover;
      margin-right: 16px;
      flex-shrink: 0;
    }

    .music-player .player-info {
      flex: 1;
      min-width: 0;
    }

    .music-player .player-title {
      font-size: 18px;
      font-weight: 700;
      color: #222;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 2px;
    }

    .music-player .player-author {
      font-size: 13px;
      color: #888;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .music-player .player-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      grid-column: 2;
    }

    .music-player .player-btn,
    .playlist-panel-wrap .player-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #3498db;
      color: #fff;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.08);
      outline: none;
    }

    .music-player .player-btn:active,
    .playlist-panel-wrap .player-btn:active {
      background: #1766a3;
    }

    .music-player .player-btn:hover,
    .playlist-panel-wrap .player-btn:hover {
      background: #217dbb;
      color: #fff;
    }

    .music-player .player-progress {
      flex: 1;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      margin: 0 10px;
      position: relative;
      cursor: pointer;
    }

    .music-player .player-progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: #3498db;
      border-radius: 2px;
    }

    .music-player .player-time {
      font-size: 12px;
      color: #888;
      min-width: 60px;
      text-align: right;
    }

    .music-player .player-volume {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .music-player .player-volume-bar {
      width: 60px;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      position: relative;
      cursor: pointer;
    }

    .music-player .player-volume-level {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: #3498db;
      border-radius: 2px;
    }

    .music-player .close-player {
      margin-left: 10px;
      font-size: 18px;
      color: #bbb;
      cursor: pointer;
      background: none;
      border: none;
      transition: color 0.2s;
    }

    .music-player .close-player:hover {
      color: #e74c3c;
    }

    .music-player .resize-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 8px;
      height: 100%;
      cursor: ew-resize;
      z-index: 10;
      background: transparent;
    }

    .music-player .resize-handle:hover {
      background: #eaf3ff;
    }

    .lyrics-container {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
    }

    .lyrics-line {
      padding: 5px 0;
      color: #666;
      transition: color 0.3s;
    }

    .lyrics-line.active {
      color: #3498db;
      font-weight: 600;
    }

    /* æ–°å¢æ’­æ”¾åˆ—è¡¨æ ·å¼ */
    .playlist-panel-wrap {
      width: 100%;
      background: #fff;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 4px 16px rgba(52, 152, 219, 0.07);
      margin: 0 auto;
      padding: 0 0 10px 0;
      position: relative;
      left: 0;
      top: -8px;
    }

    .playlist-panel {
      margin-top: 0;
      padding: 8px 18px 0 18px;
      overflow-y: auto;
    }

    .playlist-item {
      padding: 7px 0 7px 8px;
      font-size: 15px;
      color: #333;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s, color 0.2s;
    }

    .playlist-item.active {
      background: #eaf3ff;
      color: #3498db;
      font-weight: 700;
    }

    .playlist-item:hover {
      background: #f0f6ff;
    }

    .playlist-item .playlist-artist {
      color: #aaa;
      font-size: 13px;
      font-weight: 400;
    }

    /* åŠ è½½æ›´å¤šæŒ‰é’®æ ·å¼ */
    .load-more-btn {
      display: flex;
      margin: 20px auto;
      padding: 12px 30px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .load-more-btn:hover {
      background: #217dbb;
    }

    .load-more-btn:active {
      transform: scale(0.98);
    }

    .load-more-btn .loading-spinner {
      display: none;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    .load-more-btn.loading .loading-spinner {
      display: inline-block;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* æ»šåŠ¨åŠ è½½æŒ‡ç¤ºå™¨ */
    .scroll-loader {
      text-align: center;
      padding: 15px;
      display: none;
    }

    .scroll-loader::after {
      content: "åŠ è½½ä¸­...";
      animation: dots 1.5s steps(5, end) infinite;
    }

    /* Cookieè®¾ç½®å¯¹è¯æ¡†æ ·å¼ */
    .cookie-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 3000;
      align-items: center;
      justify-content: center;
    }

    .cookie-modal-content {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .cookie-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .cookie-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .cookie-textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 20px;
      font-family: monospace;
      resize: vertical;
    }

    .cookie-result {
      margin-top: 15px;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
      font-family: monospace;
      word-break: break-all;
      display: none;
    }

    .cookie-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* è®¾ç½®æŒ‰é’®æ ·å¼ */
    .settings-btn {
      padding: 5px 10px;
      background-color: #f0f0f0;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .settings-btn:hover {
      background-color: #e0e0e0;
    }

    .settings-icon {
      font-size: 16px;
    }

    /* æŒ‰é’®ç»„æ ·å¼ */
    .header-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>HiFiNi Music List</h1>
      <div class="header-actions">
        <div class="controls">
          <button class="btn" id="refreshBtn">åˆ·æ–°é¦–é¡µæ•°æ®</button>
        </div>
        <button class="settings-btn" id="cookieSettingsBtn">
          <span class="settings-icon">âš™ï¸</span>è®¾ç½®Cookie
        </button>
      </div>
      <div class="status" id="status"></div>
    </header>

    <div class="loading"></div>
    <div class="error"></div>
    <div class="music-list" id="musicList"></div>
    <div class="scroll-loader" id="scrollLoader"></div>

    <!-- æ·»åŠ ç»“æœå®¹å™¨ -->
    <div id="resultContainer" style="display:none;">
      <div id="resultContent"></div>
    </div>
  </div>

  <!-- Cookieè®¾ç½®å¯¹è¯æ¡† -->
  <div class="cookie-modal" id="cookieModal">
    <div class="cookie-modal-content">
      <div class="cookie-modal-header">
        <h3>è®¾ç½®Cookie</h3>
        <button class="cookie-modal-close" id="closeCookieModal">&times;</button>
      </div>
      <div id="cookieInfo"></div>
      <p>è¯·ç²˜è´´Hifiniçš„Cookie JSONæ•°æ®:</p>
      <textarea class="cookie-textarea" id="cookieInput"
        placeholder='[{"domain": "www.hifini.com", "name": "bbs_sid", "value": "xxx"}, ...]'></textarea>
      <div class="cookie-result" id="cookieResult"></div>
      <div class="cookie-actions">
        <button class="btn" id="parseCookieBtn">è§£æCookie</button>
        <button class="btn" id="saveCookieBtn">ä¿å­˜åˆ°æœåŠ¡å™¨</button>
      </div>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let allMusicData = [];
    let currentMusicInfo = null;
    let playList = [];
    let playIndex = -1;
    let playMode = 'order'; // 'order' or 'random'
    let isLoadingMore = false; // æ˜¯å¦æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®
    let hasMoreData = true; // æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
    // è®¾ç½®éœ€è¦æ’é™¤çš„çº¿ç¨‹IDåˆ—è¡¨
    const excludedThreadIds = ['6', '1575', '16216'];

    // Base32 ç¼–ç å‡½æ•°
    function base32Encode(str) {
      var base32chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
      var bits = "";
      var base32 = "";

      for (var i = 0; i < str.length; i++) {
        var bit = str.charCodeAt(i).toString(2);
        while (bit.length < 8) {
          bit = "0" + bit;
        }
        bits += bit;
      }

      while (bits.length % 5 !== 0) {
        bits += "0";
      }

      for (var i = 0; i < bits.length; i += 5) {
        var chunk = bits.substring(i, i + 5);
        base32 += base32chars[parseInt(chunk, 2)];
      }

      while (base32.length % 8 !== 0) {
        base32 += "=";
      }

      return base32.replace(/=/g, 'HiFiNiYINYUECICHANG');
    }

    // ç½‘é¡µä¸Šçš„ generateParam å‡½æ•°
    function generateParam(data) {
      var key = '95wwwHiFiNicom27';
      var outText = '';

      for (var i = 0, j = 0; i < data.length; i++, j++) {
        if (j == key.length) j = 0;
        outText += String.fromCharCode(data.charCodeAt(i) ^ key.charCodeAt(j));
      }
      return base32Encode(outText);
    }

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    function displayMusicList(data, append = false) {
      const musicList = document.getElementById('musicList');

      if (!append) {
        musicList.innerHTML = '';
      }

      // è®¡ç®—éœ€è¦å¤šå°‘åˆ—ï¼ˆä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³æ’åˆ—ï¼‰
      const numRows = 10;
      const numCols = Math.ceil(data.length / numRows);

      // åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ç”¨äºé‡æ’æ•°æ®
      let reorderedData = [];
      for (let col = 0; col < numCols; col++) {
        for (let row = 0; row < numRows; row++) {
          const index = col * numRows + row;
          if (index < data.length) {
            reorderedData.push(data[index]);
          }
        }
      }

      reorderedData.forEach(item => {
        const musicInfo = parseMusicInfo(item.title);
        const musicItem = document.createElement('div');
        musicItem.className = 'music-item';
        musicItem.innerHTML = `
                    <div class="music-title">${musicInfo.title}</div>
                    <div class="music-author">${musicInfo.artist}</div>
                `;
        musicItem.onclick = () => {
          item.parsedTitle = musicInfo.title;
          item.parsedArtist = musicInfo.artist;
          // æ–°å¢ï¼šåŠ å…¥æ’­æ”¾åˆ—è¡¨
          addToPlayList({
            ...item,
            musicInfo: musicInfo
          });
        };
        musicList.appendChild(musicItem);
      });
    }

    function updatePagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => goToPage(i);
        pagination.appendChild(pageBtn);
      }
    }

    function goToPage(page) {
      currentPage = page;
      const start = (page - 1) * 20;
      const end = start + 20;
      displayMusicList(allMusicData.slice(start, end));
      updatePagination();
    }

    // è§£æéŸ³ä¹æ ‡é¢˜å’Œæ­Œæ‰‹
    function parseMusicInfo(title) {
      // åªå–ç¬¬ä¸€ä¸ªã€Šã€‹é‡Œçš„å†…å®¹ä¸ºtitleï¼Œå‰é¢ä¸ºartistï¼Œåé¢å¿½ç•¥
      const match = title.match(/^(.*?)ã€Š([^ã€‹]+)ã€‹/);
      if (match) {
        return {
          artist: match[1].replace(/\[.*?\]/g, '').trim(),
          title: match[2].trim()
        };
      }
      return {
        artist: '',
        title: title.trim()
      };
    }

    // æ˜¾ç¤ºéŸ³ä¹è¯¦æƒ…çš„å‡½æ•°
    function displayMusicDetail(detail) {
      let musicUrl = detail.musicUrl;
      if (detail.rawKey && detail.generateParamString) {
        const newP = generateParam(detail.generateParamString);
        musicUrl += `?key=${detail.rawKey}&p=${newP}`;
        const audio = new Audio(musicUrl);
        let floatWrap = document.querySelector('.player-float-wrap');
        let player, playlistPanel;
        if (!floatWrap) {
          floatWrap = document.createElement('div');
          floatWrap.className = 'player-float-wrap';
          floatWrap.style.left = '';
          floatWrap.style.top = '30px';
          floatWrap.style.right = '30px';
          floatWrap.style.bottom = '';
          document.body.appendChild(floatWrap);
        }
        // æ’­æ”¾å™¨å’Œæ’­æ”¾åˆ—è¡¨
        player = floatWrap.querySelector('.music-player');
        playlistPanel = floatWrap.querySelector('.playlist-panel-wrap');
        if (!player) {
          player = document.createElement('div');
          player.className = 'music-player';
          floatWrap.appendChild(player);
        }
        if (!playlistPanel) {
          playlistPanel = document.createElement('div');
          playlistPanel.className = 'playlist-panel-wrap';
          floatWrap.appendChild(playlistPanel);
        }
        if (player.audio) player.audio.pause();
        player.audio = audio;
        const showTitle = (currentMusicInfo && currentMusicInfo.title) ? currentMusicInfo.title : '';
        const showArtist = (currentMusicInfo && currentMusicInfo.artist) ? currentMusicInfo.artist : '';
        player.innerHTML = `
                    <div class="player-header-draggable">
                        <img src="${detail.coverImage || 'https://via.placeholder.com/100'}" class="player-cover"/>
                        <div class="player-info">
                            <div class="player-title">${showTitle}</div>
                            <div class="player-author">${showArtist}</div>
                        </div>
                    </div>
                    <div class="player-controls">
                        <button class="player-btn play" onclick="togglePlay(this)"><i class="play-icon">â–¶</i></button>
                        <div class="player-progress" onclick="seek(event)"><div class="player-progress-bar" style="width:0%"></div></div>
                        <div class="player-time">0:00 / 0:00</div>
                        <div class="player-volume">
                            <button class="player-btn" onclick="toggleMute(this)"><i class="volume-icon">ğŸ”Š</i></button>
                            <div class="player-volume-bar" onclick="setVolume(event)"><div class="player-volume-level" style="width:100%"></div></div>
                        </div>
                    </div>
                    <button class="close-player" onclick="closeFloatingPlayer(event)">&times;</button>
                    <div class="resize-handle"></div>
                `;

        // å¿…é¡»åœ¨åˆ›å»ºå†…å®¹åå†ç»‘å®šäº‹ä»¶
        if (!floatWrap._resizeBound) {
          enablePlayerResize(floatWrap);
          floatWrap._resizeBound = true;
        }

        // é‡æ–°ç»‘å®šæ‹–æ‹½äº‹ä»¶
        enablePlayerResize(floatWrap);
        enablePlayerDrag(floatWrap);

        const playBtn = player.querySelector('.player-btn.play');
        const playIcon = playBtn.querySelector('.play-icon');
        const progressBar = player.querySelector('.player-progress-bar');
        const timeDisplay = player.querySelector('.player-time');
        const volumeBar = player.querySelector('.player-volume-level');
        audio.addEventListener('play', () => { playIcon.textContent = 'â¸'; });
        audio.addEventListener('pause', () => { playIcon.textContent = 'â–¶'; });
        audio.addEventListener('timeupdate', () => {
          const progress = (audio.currentTime / audio.duration) * 100;
          progressBar.style.width = `${progress}%`;
          timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        });
        audio.addEventListener('volumechange', () => {
          volumeBar.style.width = `${audio.volume * 100}%`;
        });
        // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–
        audio.addEventListener('ended', () => {
          playNext({ stopPropagation: () => { } });
        });
        audio.play().catch(() => { });
        setTimeout(() => {
          renderPlayList();
        }, 100);
      } else {
        const resultContent = document.getElementById('resultContent');
        if (resultContent) {
          resultContent.innerHTML = `
                        <div class="music-player">
                            <div class="player-header">
                                <div class="player-info">
                                    <div class="player-title">${detail.title}</div>
                                    <div class="player-author">${detail.author || 'æœªçŸ¥ä½œè€…'}</div>
                                </div>
                            </div>
                            ${detail.lyrics ? `
                                <div class="lyrics-container">
                                    ${detail.lyrics.split('\n').map(line => `
                                        <div class="lyrics-line">${line}</div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            <div style="margin-top: 20px;">
                                <strong>ä¸‹è½½é“¾æ¥:</strong><br>
                                ${detail.downloadLinks.map(link => `
                                    <a href="${link}" target="_blank" style="color: #3498db; text-decoration: none;">${link}</a><br>
                                `).join('')}
                            </div>
                        </div>
                    `;
          document.getElementById('resultContainer').style.display = 'block';
        }
      }
    }

    function closeFloatingPlayer(e) {
      const player = document.querySelector('.music-player');
      if (player && player.audio) player.audio.pause();
      if (player) player.remove();
      document.removeEventListener('mousedown', floatingPlayerClickAway, true);
    }

    function floatingPlayerClickAway(e) {
      const player = document.querySelector('.music-player');
      if (player && !player.contains(e.target)) {
        closeFloatingPlayer();
      }
    }

    // æ’­æ”¾æ§åˆ¶å‡½æ•°
    function togglePlay(button) {
      const player = document.querySelector('.music-player');
      const audio = player.audio;
      const icon = button.querySelector('.play-icon');

      if (audio.paused) {
        audio.play();
        icon.textContent = 'â¸';
      } else {
        audio.pause();
        icon.textContent = 'â–¶';
      }
    }

    function seek(event) {
      const player = document.querySelector('.music-player');
      const audio = player.audio;
      const progressBar = event.currentTarget;
      const rect = progressBar.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const percentage = x / rect.width;
      audio.currentTime = audio.duration * percentage;
    }

    function toggleMute(button) {
      const player = document.querySelector('.music-player');
      const audio = player.audio;
      const icon = button.querySelector('.volume-icon');

      if (audio.muted) {
        audio.muted = false;
        icon.textContent = 'ğŸ”Š';
      } else {
        audio.muted = true;
        icon.textContent = 'ğŸ”‡';
      }
    }

    function setVolume(event) {
      const player = document.querySelector('.music-player');
      const audio = player.audio;
      const volumeBar = event.currentTarget;
      const rect = volumeBar.getBoundingClientRect();
      const x = event.clientX - rect.left;
      audio.volume = x / rect.width;
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      seconds = Math.floor(seconds % 60);
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // è·å–çº¿ç¨‹å†…å®¹çš„å‡½æ•°
    async function fetchThreadContent(threadId) {
      try {
        updateStatus(`æ­£åœ¨è·å–çº¿ç¨‹ ${threadId} çš„å†…å®¹...`);

        const response = await fetch(`/music/${threadId}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const detail = await response.json();
        displayMusicDetail(detail);
        updateStatus(`å·²è·å–çº¿ç¨‹ ${threadId} çš„å†…å®¹`);
      } catch (error) {
        console.error('Error fetching thread content:', error);
        updateStatus(`è·å–çº¿ç¨‹ ${threadId} å¤±è´¥: ${error.message}`);

        const resultContent = document.getElementById('resultContent');
        resultContent.innerHTML = `<span style="color: red;">è·å–å¤±è´¥: ${error.message}</span>`;
        document.getElementById('resultContainer').style.display = 'block';
      }
    }

    async function fetchPage(page) {
      const response = await fetch(`/api/songs?page=${page}`);
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return await response.json();
    }

    // æ–°å¢ï¼šå…¨å±€å»é‡å‡½æ•°
    function removeDuplicates(array, idField = 'threadId') {
      const seen = new Set();
      return array.filter(item => {
        const id = item[idField];
        if (seen.has(id)) {
          return false;
        }
        seen.add(id);
        return true;
      });
    }

    // è¿‡æ»¤æ‰æ’é™¤çš„çº¿ç¨‹ID
    function filterExcludedThreads(data) {
      return data.filter(item => !excludedThreadIds.includes(item.threadId));
    }

    // è·å–å·²åŠ è½½æ­Œæ›²çš„IDé›†åˆ
    function getExistingIds() {
      return new Set(allMusicData.map(item => item.threadId));
    }

    // æ£€æŸ¥CookieçŠ¶æ€çš„å‡½æ•°
    async function checkCookieStatus() {
      try {
        const response = await fetch('/api/cookieStatus');
        if (!response.ok) {
          throw new Error('è·å–CookieçŠ¶æ€å¤±è´¥');
        }

        const status = await response.json();

        if (status.needsUpdate) {
          // æ˜¾ç¤ºCookieè®¾ç½®å¯¹è¯æ¡†
          showCookieModal(true);
          updateStatus('æ‚¨çš„Cookieå·²è¿‡æœŸæˆ–æœªè®¾ç½®ï¼Œè¯·æ›´æ–°Cookie');
          return false;
        }

        return true;
      } catch (error) {
        console.error('æ£€æŸ¥CookieçŠ¶æ€å‡ºé”™:', error);
        updateStatus('æ£€æŸ¥CookieçŠ¶æ€å‡ºé”™: ' + error.message);
        return false;
      }
    }

    // æ˜¾ç¤ºæˆ–éšè—Cookieè®¾ç½®å¯¹è¯æ¡†
    function showCookieModal(forced = false) {
      const cookieModal = document.getElementById('cookieModal');
      cookieModal.style.display = 'flex';

      // å¦‚æœæ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œæ·»åŠ æç¤ºä¿¡æ¯
      if (forced) {
        const cookieInfoEl = document.getElementById('cookieInfo');
        if (cookieInfoEl) {
          cookieInfoEl.innerHTML = '<div style="color: #e74c3c; margin-bottom: 10px; font-weight: bold;">âš ï¸ Cookieå·²è¿‡æœŸæˆ–æœªè®¾ç½®ï¼Œè¯·æ›´æ–°åæ‰èƒ½ç»§ç»­ä½¿ç”¨</div>';
        }

        // ç¦ç”¨å…³é—­æŒ‰é’®
        const closeBtn = document.getElementById('closeCookieModal');
        if (closeBtn) {
          closeBtn.style.display = 'none';
        }

        // é˜»æ­¢ç‚¹å‡»å¤–éƒ¨å…³é—­
        cookieModal.dataset.forced = 'true';
      } else {
        // æ¢å¤å…³é—­æŒ‰é’®
        const closeBtn = document.getElementById('closeCookieModal');
        if (closeBtn) {
          closeBtn.style.display = 'block';
        }

        // å…è®¸æ­£å¸¸å…³é—­
        cookieModal.dataset.forced = 'false';

        // æ¸…é™¤æç¤ºä¿¡æ¯
        const cookieInfoEl = document.getElementById('cookieInfo');
        if (cookieInfoEl) {
          cookieInfoEl.innerHTML = '';
        }
      }
    }

    async function loadMoreData() {
      if (isLoadingMore || !hasMoreData) return;

      // æ£€æŸ¥CookieçŠ¶æ€
      const cookieValid = await checkCookieStatus();
      if (!cookieValid) {
        return; // å¦‚æœCookieæ— æ•ˆï¼Œåœæ­¢åŠ è½½
      }

      isLoadingMore = true;
      const scrollLoader = document.getElementById('scrollLoader');
      scrollLoader.style.display = 'block';

      try {
        updateStatus(`æ­£åœ¨åŠ è½½æ›´å¤šæ­Œæ›²...`);
        const pageData = await fetchPage(currentPage);

        // è¿‡æ»¤æ‰æ’é™¤çš„çº¿ç¨‹ID
        const filteredData = filterExcludedThreads(pageData);

        // è¿‡æ»¤é‡å¤æ•°æ®
        const existingIds = getExistingIds();
        const newData = filteredData.filter(item => !existingIds.has(item.threadId));

        if (newData.length === 0) {
          hasMoreData = false;
          updateStatus(`æ²¡æœ‰æ›´å¤šæ­Œæ›²äº†`);
          scrollLoader.style.display = 'none';
          return;
        }

        // åˆå¹¶å»é‡åçš„æ•°æ®
        allMusicData = [...allMusicData, ...newData];
        displayMusicList(newData, true);
        currentPage++;

        updateStatus(`å·²åŠ è½½ ${allMusicData.length} é¦–æ­Œæ›²`);
      } catch (err) {
        const error = document.querySelector('.error');
        error.textContent = 'åŠ è½½å¤±è´¥: ' + err.message;
        error.style.display = 'block';
        hasMoreData = false; // å‡ºé”™æ—¶åœæ­¢åŠ è½½
      } finally {
        isLoadingMore = false;
        scrollLoader.style.display = 'none';
      }
    }

    // æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬
    function setupInfiniteScroll() {
      window.addEventListener('scroll', () => {
        if (isLoadingMore || !hasMoreData) return;

        const scrollY = window.scrollY;
        const visibleHeight = window.innerHeight;
        const pageHeight = document.documentElement.scrollHeight;
        const bottomOfPage = visibleHeight + scrollY >= pageHeight - 300;

        if (bottomOfPage) {
          loadMoreData();
        }
      });
    }

    // æ–°å¢ï¼šåŠ å…¥æ’­æ”¾åˆ—è¡¨
    function addToPlayList(song) {
      // æ£€æŸ¥æ˜¯å¦å·²åœ¨æ’­æ”¾åˆ—è¡¨ä¸­ï¼ˆå¯æ ¹æ® threadId å”¯ä¸€æ€§ï¼‰
      const exists = playList.findIndex(s => s.threadId === song.threadId);
      if (exists === -1) {
        // æ–°æ­Œæ’å…¥åˆ°å½“å‰æ’­æ”¾æ­Œæ›²åé¢
        if (playIndex >= 0 && playIndex < playList.length - 1) {
          playList.splice(playIndex + 1, 0, song);
        } else {
          playList.push(song);
        }
      }
      // å¦‚æœæ²¡æœ‰æ­£åœ¨æ’­æ”¾ï¼Œåˆ™ç«‹å³æ’­æ”¾
      if (playIndex === -1) {
        playIndex = playList.length - 1;
        fetchThreadContentAndPlay(playList[playIndex]);
      }
      renderPlayList();
    }

    // æ–°å¢ï¼šæ¸²æŸ“æ’­æ”¾åˆ—è¡¨
    function renderPlayList() {
      let player = document.querySelector('.music-player');
      if (!player) return;
      let listHtml = '<div class="playlist-panel">';
      playList.forEach((song, idx) => {
        listHtml += `<div class="playlist-item${idx === playIndex ? ' active' : ''}" onclick="playFromList(${idx})">${song.musicInfo.title}<span class='playlist-artist'>${song.musicInfo.artist}</span></div>`;
      });
      listHtml += '</div>';
      // æ’­æ”¾æ¨¡å¼åˆ‡æ¢æŒ‰é’®å’Œä¸Šä¸€é¦–/ä¸‹ä¸€é¦–æ ·å¼ç»Ÿä¸€
      listHtml += `<div style='margin-top:6px;display:flex;align-items:center;gap:8px;'>`;
      listHtml += `<button class='player-btn mode-btn' onclick='togglePlayMode(event)' title='é¡ºåº/éšæœº' style='font-size:16px;'>${playMode === 'order' ? 'â©' : 'ğŸ”€'}</button>`;
      listHtml += `<button class='player-btn prev-btn' onclick='playPrev(event)' title='ä¸Šä¸€é¦–' style='font-size:16px;'>â®</button>`;
      listHtml += `<button class='player-btn next-btn' onclick='playNext(event)' title='ä¸‹ä¸€é¦–' style='font-size:16px;'>â­</button>`;
      listHtml += `</div>`;
      let playlistPanel = document.querySelector('.playlist-panel-wrap');
      if (!playlistPanel) {
        playlistPanel = document.createElement('div');
        playlistPanel.className = 'playlist-panel-wrap';
        // æ’­æ”¾å™¨ä¸‹æ–¹æ’å…¥
        player.parentNode.insertBefore(playlistPanel, player.nextSibling);
      }
      playlistPanel.innerHTML = listHtml;
    }

    // æ–°å¢ï¼šåˆ‡æ¢æ’­æ”¾æ¨¡å¼
    function togglePlayMode(e) {
      e.stopPropagation();
      playMode = playMode === 'order' ? 'random' : 'order';
      renderPlayList();
    }
    // æ–°å¢ï¼šæ’­æ”¾ä¸Šä¸€é¦–
    function playPrev(e) {
      e.stopPropagation();
      if (playList.length === 0) return;
      if (playMode === 'random') {
        let idx;
        do { idx = Math.floor(Math.random() * playList.length); } while (idx === playIndex && playList.length > 1);
        playIndex = idx;
      } else {
        playIndex = (playIndex - 1 + playList.length) % playList.length;
      }
      fetchThreadContentAndPlay(playList[playIndex]);
    }
    // æ–°å¢ï¼šæ’­æ”¾ä¸‹ä¸€é¦–
    function playNext(e) {
      e.stopPropagation();
      if (playList.length === 0) return;
      if (playMode === 'random') {
        let idx;
        do { idx = Math.floor(Math.random() * playList.length); } while (idx === playIndex && playList.length > 1);
        playIndex = idx;
      } else {
        playIndex = (playIndex + 1) % playList.length;
      }
      fetchThreadContentAndPlay(playList[playIndex]);
    }
    // æ–°å¢ï¼šç‚¹å‡»æ’­æ”¾åˆ—è¡¨åˆ‡æ­Œ
    function playFromList(idx) {
      playIndex = idx;
      fetchThreadContentAndPlay(playList[playIndex]);
    }
    // æ–°å¢ï¼šæ ¹æ®songå¯¹è±¡è·å–è¯¦æƒ…å¹¶æ’­æ”¾
    function fetchThreadContentAndPlay(song) {
      currentMusicInfo = song.musicInfo;
      fetch(`/music/${song.threadId}`)
        .then(res => res.json())
        .then(detail => displayMusicDetail(detail));
    }

    // æ‹–åŠ¨æ•´ä½“æµ®çª—
    function enablePlayerDrag(floatWrap) {
      if (!floatWrap) return;
      const header = floatWrap.querySelector('.player-header-draggable');
      if (!header) return;

      // å…ˆç§»é™¤æ—§ç›‘å¬å™¨
      header.removeEventListener('mousedown', header._mousedownHandler);

      // å®šä¹‰æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°
      let isDragging = false;
      let startX, startY, startLeft, startTop;
      header._mousedownHandler = function (e) {
        if (e.button !== 0) return;
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = floatWrap.getBoundingClientRect();
        startLeft = rect.left;
        startTop = rect.top;
        document.body.style.userSelect = 'none';

        // é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
        e.stopPropagation();
        e.preventDefault();
      };

      // ç»‘å®šäº‹ä»¶
      header.addEventListener('mousedown', header._mousedownHandler);

      // ç§»é™¤æ—§çš„mousemoveå’Œmouseupå¤„ç†
      document.removeEventListener('mousemove', document._mousemoveHandler);
      document.removeEventListener('mouseup', document._mouseupHandler);

      // å®šä¹‰æ–°çš„mousemoveå¤„ç†
      document._mousemoveHandler = function (e) {
        if (!isDragging || !floatWrap) return;
        let newLeft = startLeft + (e.clientX - startX);
        let newTop = startTop + (e.clientY - startY);
        newLeft = Math.max(0, Math.min(window.innerWidth - floatWrap.offsetWidth, newLeft));
        newTop = Math.max(0, Math.min(window.innerHeight - floatWrap.offsetHeight, newTop));
        floatWrap.style.left = newLeft + 'px';
        floatWrap.style.top = newTop + 'px';
        floatWrap.style.right = '';
        floatWrap.style.bottom = '';

        // é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
        e.stopPropagation();
        e.preventDefault();
      };

      // å®šä¹‰æ–°çš„mouseupå¤„ç†
      document._mouseupHandler = function () {
        isDragging = false;
        document.body.style.userSelect = '';
      };

      // ç»‘å®šäº‹ä»¶
      document.addEventListener('mousemove', document._mousemoveHandler);
      document.addEventListener('mouseup', document._mouseupHandler);
    }

    // è®©æ’­æ”¾å™¨æ•´ä½“å®½åº¦å¯æ‹–åŠ¨
    function enablePlayerResize(floatWrap) {
      if (!floatWrap) return;
      let player = floatWrap.querySelector('.music-player');
      if (!player) return;
      let handle = floatWrap.querySelector('.resize-handle');
      if (!handle) {
        handle = document.createElement('div');
        handle.className = 'resize-handle';
        player.appendChild(handle);
      }
      let isResizing = false;
      let startX, startWidth;
      handle.onmousedown = function (e) {
        e.stopPropagation();
        isResizing = true;
        startX = e.clientX;
        startWidth = floatWrap.offsetWidth;
        document.body.style.userSelect = 'none';
      };
      document.onmousemove = function (e) {
        if (!isResizing) return;
        let newWidth = startWidth + (e.clientX - startX);
        newWidth = Math.max(320, Math.min(window.innerWidth * 0.9, newWidth));
        floatWrap.style.width = newWidth + 'px';
      };
      document.onmouseup = function () {
        isResizing = false;
        document.body.style.userSelect = '';
      };
    }

    // æ’­æ”¾/æš‚åœé”®æ§åˆ¶
    function setupSpacebarControl() {
      document.addEventListener('keydown', (e) => {
        // 32 æ˜¯ç©ºæ ¼é”®çš„ keyCode
        if (e.keyCode === 32 || e.key === ' ') {
          // æŸ¥æ‰¾å½“å‰æ˜¯å¦æœ‰æ´»åŠ¨çš„è¾“å…¥æ¡†
          const activeElement = document.activeElement;
          const isInputActive = activeElement && (
            activeElement.tagName === 'INPUT' ||
            activeElement.tagName === 'TEXTAREA' ||
            activeElement.isContentEditable
          );

          // å¦‚æœä¸æ˜¯åœ¨è¾“å…¥æ¡†ä¸­ï¼Œåˆ™æ§åˆ¶æ’­æ”¾/æš‚åœ
          if (!isInputActive) {
            e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆæ»šåŠ¨é¡µé¢ï¼‰

            const player = document.querySelector('.music-player');
            if (player && player.audio) {
              if (player.audio.paused) {
                player.audio.play();
                player.querySelector('.play-icon').textContent = 'â¸';
              } else {
                player.audio.pause();
                player.querySelector('.play-icon').textContent = 'â–¶';
              }
            }
          }
        }
      });
    }

    // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®ç©ºæ ¼é”®æ§åˆ¶
    document.addEventListener('DOMContentLoaded', () => {
      setupSpacebarControl();
      initializeApp();
    });

    // åˆ·æ–°é¦–é¡µæ•°æ®
    async function refreshFirstPage() {
      if (isLoadingMore) return;

      // å…ˆæ£€æŸ¥CookieçŠ¶æ€
      const cookieValid = await checkCookieStatus();
      if (!cookieValid) {
        return; // å¦‚æœCookieæ— æ•ˆï¼Œåœæ­¢åˆ·æ–°
      }

      isLoadingMore = true;
      const loading = document.querySelector('.loading');
      const error = document.querySelector('.error');
      const refreshBtn = document.getElementById('refreshBtn');

      loading.style.display = 'block';
      error.style.display = 'none';
      refreshBtn.disabled = true;

      try {
        updateStatus(`æ­£åœ¨åˆ·æ–°é¦–é¡µæ•°æ®...`);
        const pageData = await fetchPage(1); // å§‹ç»ˆè·å–ç¬¬ä¸€é¡µ

        // è¿‡æ»¤æ‰æ’é™¤çš„çº¿ç¨‹ID
        const filteredData = filterExcludedThreads(pageData);

        // è®°å½•å½“å‰æ•°æ®çš„IDsä»¥ä¾¿å¯¹æ¯”
        const existingIds = getExistingIds();

        // è¿‡æ»¤å‡ºæ–°æ•°æ®
        const newData = filteredData.filter(item => !existingIds.has(item.threadId));

        if (newData.length === 0) {
          updateStatus(`æ²¡æœ‰å‘ç°æ–°çš„æ­Œæ›²æ•°æ®`);
        } else {
          // å°†æ–°æ•°æ®æ·»åŠ åˆ°ç°æœ‰æ•°æ®çš„å¼€å¤´
          allMusicData = [...newData, ...allMusicData];

          // é‡æ–°æ˜¾ç¤ºå®Œæ•´çš„æ•°æ®åˆ—è¡¨
          displayMusicList(allMusicData, false);

          updateStatus(`å·²æ·»åŠ  ${newData.length} é¦–æ–°æ­Œæ›²ï¼Œæ€»è®¡ ${allMusicData.length} é¦–æ­Œæ›²`);

          // ç¡®ä¿å¯ä»¥ç»§ç»­æ— é™æ»šåŠ¨
          hasMoreData = true;
        }
      } catch (err) {
        error.textContent = 'åˆ·æ–°æ•°æ®å¤±è´¥: ' + err.message;
        error.style.display = 'block';
      } finally {
        isLoadingMore = false;
        loading.style.display = 'none';
        refreshBtn.disabled = false;
      }
    }

    // Cookieå¤„ç†å‡½æ•°
    function setupCookieModal() {
      const cookieSettingsBtn = document.getElementById('cookieSettingsBtn');
      const cookieModal = document.getElementById('cookieModal');
      const closeCookieModal = document.getElementById('closeCookieModal');
      const cookieInput = document.getElementById('cookieInput');
      const cookieResult = document.getElementById('cookieResult');
      const parseCookieBtn = document.getElementById('parseCookieBtn');
      const saveCookieBtn = document.getElementById('saveCookieBtn');

      // æ‰“å¼€å¯¹è¯æ¡†
      cookieSettingsBtn.addEventListener('click', () => {
        showCookieModal(false);
      });

      // å…³é—­å¯¹è¯æ¡†
      closeCookieModal.addEventListener('click', () => {
        cookieModal.style.display = 'none';
      });

      // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
      window.addEventListener('click', (e) => {
        if (e.target === cookieModal && cookieModal.dataset.forced !== 'true') {
          cookieModal.style.display = 'none';
        }
      });

      // è§£æCookie
      parseCookieBtn.addEventListener('click', () => {
        try {
          const cookieJson = cookieInput.value.trim();
          let cookieArray;

          try {
            cookieArray = JSON.parse(cookieJson);
          } catch (e) {
            throw new Error('Cookie JSONæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
          }

          if (!Array.isArray(cookieArray)) {
            throw new Error('Cookieæ ¼å¼å¿…é¡»æ˜¯æ•°ç»„');
          }

          // æ„å»ºCookieå­—ç¬¦ä¸²
          const cookieStr = cookieArray
            .filter(cookie => cookie.name && cookie.value)
            .map(cookie => `${cookie.name}=${cookie.value}`)
            .join('; ');

          // æ˜¾ç¤ºç»“æœ
          cookieResult.style.display = 'block';
          cookieResult.textContent = cookieStr;

          // å¯ç”¨ä¿å­˜æŒ‰é’®
          saveCookieBtn.disabled = false;
        } catch (error) {
          cookieResult.style.display = 'block';
          cookieResult.textContent = `é”™è¯¯: ${error.message}`;
          saveCookieBtn.disabled = true;
        }
      });

      // ä¿å­˜Cookieåˆ°æœåŠ¡å™¨
      saveCookieBtn.addEventListener('click', async () => {
        const cookieStr = cookieResult.textContent;
        if (!cookieStr || saveCookieBtn.disabled) return;

        try {
          updateStatus('æ­£åœ¨ä¿å­˜Cookie...');

          const response = await fetch('/api/setCookie', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ cookie: cookieStr })
          });

          if (!response.ok) {
            throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status}`);
          }

          const result = await response.json();

          if (result.success) {
            updateStatus('Cookieè®¾ç½®æˆåŠŸ');
            cookieModal.style.display = 'none';

            // åˆ·æ–°æ•°æ®
            refreshFirstPage();
          } else {
            throw new Error(result.message || 'ä¿å­˜å¤±è´¥');
          }
        } catch (error) {
          updateStatus(`Cookieè®¾ç½®å¤±è´¥: ${error.message}`);
        }
      });
    }

    // åˆå§‹åŒ–åŠ è½½
    async function initializeApp() {
      const loading = document.querySelector('.loading');
      loading.style.display = 'block';

      try {
        // é¦–å…ˆæ£€æŸ¥CookieçŠ¶æ€
        const cookieValid = await checkCookieStatus();

        if (cookieValid) {
          await loadMoreData();
          setupInfiniteScroll();
        }

        // æ·»åŠ åˆ·æ–°æŒ‰é’®äº‹ä»¶ç›‘å¬
        const refreshBtn = document.getElementById('refreshBtn');
        refreshBtn.addEventListener('click', refreshFirstPage);

        // è®¾ç½®Cookieå¯¹è¯æ¡†
        setupCookieModal();
      } finally {
        loading.style.display = 'none';
      }
    }
  </script>
</body>

</html>